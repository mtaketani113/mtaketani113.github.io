---
layout: default
title: WindowsのCSVのContentTypeがかわった
description: ある日突然WindowsでEDGEを使っている人が、CSVファイルをアップロードできなくなりました。原因はContentTypeでCSVかを判定していたためです。バージョン100以降からtext/csvに代わったようです。
category: IT
created_at: 2022-04-15
last_modifeid_at: 2022-04-15
---

WindwosのEDGEで利用すること前提の社内システムがあるのですが、
ある日突然、何人かの人がCSVファイルをアップロードできないと訴えてきました。

なぜかわからず、CSVファイルはテキストなので文字コードとかBOMとかの差があってアップロードできないのかと思って色々と試したのですが、どんなにやっても再現できず困っていました。

環境の違いが原因かと思い、EDGEの設定を見てたのですが、
たまたまバージョンが少し古い（99.xxx）ことがわかり最新(100.xxx)にアップデートしてみました。

すると再現するではありませんか(*'▽')

原因はContent-TypeでCSVかを判定していたためです。バージョン100以降からtext/csvに代わったようです。

99までだと以下のような判定でした。
- Excelありの端末：`application/vnd.ms-excel`
- Excelなしの端末：`application/octet-stream`

それが100になると`text/csv`に変わってしまったようです。

社内システムがCSVかどうかを`Content-Type`で確認していたため発生してしまったようです。
色気づかず、拡張子で見るとかすればよかったのかな？

## まとめ

CSVファイルのContent-typeが`text/csv`にバージョン100代から変わったようです。
人によって最新になってない人もいるのでContent-typeで判定していると急に動きが変わったりするかもしれません。
もしかしたら今回記載した内容が原因かもしれませんので、参考にしてください。

あと、人によって動きが違うとか、再現しないとかはクライアント環境を疑ってみるのが早そうですね。